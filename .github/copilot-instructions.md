# Copilot Instructions for AI Agents

## Project Overview

- **Monorepo** with two main components:
  - `api/` — .NET 9 FastEndpoints backend (see `api/src/online/`)
  - `client/` — SvelteKit frontend (see `client/src/`)
- **Purpose:** Public site for booking and member login, with Google authentication and user management.

## Key Workflows

### Backend (API)

- **Build/Run:**
  - Use VS Code task `API` or: `dotnet run --project api/src/online/online.csproj --no-restore`
- **Migrations:**
  - Add: VS Code task `EF Migration Add` (prompts for migration name)
  - Remove: VS Code task `EF Migration Remove`
  - Revert: VS Code task `EF Revert` (prompts for migration name)
- **Secrets:**
  - Managed via `dotnet user-secrets` (see `README.md` for commands)
- **App Entry:** `api/src/online/Program.cs` — configures all services via extension methods in `Common/Extensions/`
- **Patterns:**
  - Service registration via `Configure*` extension methods
  - Health checks, telemetry, and OpenAPI docs enabled in development
  - Auth via JWT, Google OAuth (see `AccountService.cs`)

### Frontend (Client)

- **Dev server:** `pnpm run dev` (in `client/`)
- **Build:** `pnpm run build`
- **Preview:** `pnpm run preview`
- **Tests:**
  - Unit: Vitest (see `vite.config.ts` for config)
  - E2E: Playwright (see `client/e2e/` and `playwright.config.ts`)
- **API Types/Clients:**
  - Generated by Orval from `swagger.json` (see `orval.config.ts`)
  - Custom fetch logic in `src/lib/api/mutator/customInstance.svelte.ts`
  - Use const for functions instead of function expressions
  - Use the new Svelte 5 syntax, including:
  - `$state(value)` for state variables (do not import `$state`—assume it is globally available).
  - `$effect(() => { ... })` for effects instead of `$:`. But don't overuse it; prefer `$derived` for derived state if possible.
  - `$derived()` or `$derived.by(()=>{ /* complex logic */ return result})` for derived state.
  - Component props: declare props with types using the new `type Props = { ... }` and `let { prop } = $props();` pattern.
  - Use normal HTML element events (e.g., `on:click` is now `onclick`).
  - Avoid legacy Svelte 3/4 patterns.
  - Instead of `onclick|preventDefault`, use `onclick={(event) => { event.preventDefault(); ... }}` for event handling.
  - `<svelte:component>` is deprecated in runes mode — components are dynamic by default like `<MyComponent />` or as attributes `<props.icon/>`

## Conventions & Patterns

- **Backend:**
  - Use FastEndpoints for API endpoints
  - Service/DI registration in `Common/Extensions/`
  - Entity Framework for data (see `Data/`)
- **Frontend:**
  - SvelteKit routing in `src/routes/`
  - API calls via generated clients in `src/lib/api/generated/`
  - Use Svelte Query for data fetching/mutation
  - Linting: ESLint + Prettier (see `eslint.config.js`)

## Integration Points

- **API <-> Client:**
  - OpenAPI spec at `swagger.json` (regenerate clients with Orval)
  - Auth flows: Google login endpoints in both API and generated client code
- **Secrets:**
  - Never commit secrets; use `dotnet user-secrets` for local dev

## Examples

- **Add a new API endpoint:**
  - Implement in FastEndpoints in `api/src/online/Features/`
  - Register any new services in `Common/Extensions/`
  - Update `swagger.json` and regenerate client types
- **Add a new page:**
  - Create Svelte file in `client/src/routes/`
  - Use generated API client for backend calls

## References

- See `README.md` in root and `client/` for more details
- Key files: `api/src/online/Program.cs`, `client/orval.config.ts`, `client/vite.config.ts`, `client/src/lib/api/mutator/customInstance.svelte.ts`

---

For any unclear or missing conventions, ask for clarification or check the latest code patterns in the relevant directory.
